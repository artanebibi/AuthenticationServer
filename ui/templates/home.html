<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyApp - Home</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Navbar Styles */
        nav {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 30px;
            align-items: center;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: #333;
            font-weight: 500;
            transition: color 0.3s ease;
            position: relative;
        }

        .nav-links a:hover {
            color: #667eea;
        }

        .nav-links a.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .auth-buttons {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            cursor: pointer;
            border: none;
            font-size: 14px;
        }

        .btn-login {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-login:hover {
            background: #667eea;
            color: white;
        }

        .btn-register {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-register:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-logout {
            background: #ef4444;
            color: white;
        }

        .btn-logout:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Mobile Menu Toggle */
        .menu-toggle {
            display: none;
            flex-direction: column;
            cursor: pointer;
            gap: 5px;
        }

        .menu-toggle span {
            width: 25px;
            height: 3px;
            background: #333;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        /* Hero Section */
        .hero {
            max-width: 1200px;
            margin: 0 auto;
            padding: 100px 20px;
            text-align: center;
            color: white;
        }

        .hero h1 {
            font-size: 56px;
            font-weight: 800;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .hero p {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.95;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .hero-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .hero .btn {
            padding: 16px 40px;
            font-size: 16px;
        }

        .btn-primary {
            background: white;
            color: #667eea;
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(255, 255, 255, 0.3);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid white;
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Features Section */
        .features {
            background: white;
            padding: 80px 20px;
        }

        .features-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .features h2 {
            text-align: center;
            font-size: 40px;
            margin-bottom: 60px;
            color: #333;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 40px;
        }

        .feature-card {
            padding: 30px;
            border-radius: 16px;
            background: #f8f9fa;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 20px;
        }

        .feature-card h3 {
            font-size: 22px;
            margin-bottom: 12px;
            color: #333;
        }

        .feature-card p {
            color: #666;
            line-height: 1.6;
        }

        /* Page Content */
        .page-content {
            display: none;
            min-height: calc(100vh - 70px);
            padding: 40px 20px;
        }

        .page-content.active {
            display: block;
        }

        /* Profile Page */
        .profile-container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        .profile-header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: white;
            font-weight: 700;
            margin: 0 auto 20px;
        }

        .profile-header h2 {
            color: #333;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .profile-header p {
            color: #666;
            font-size: 16px;
        }

        .profile-info {
            display: grid;
            gap: 20px;
        }

        .info-row {
            display: flex;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
            align-items: center;
        }

        .info-label {
            font-weight: 600;
            color: #667eea;
            min-width: 150px;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .info-value {
            color: #333;
            font-size: 16px;
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message-box {
            background: #fee;
            color: #c00;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                position: absolute;
                top: 70px;
                left: 0;
                right: 0;
                background: rgba(255, 255, 255, 0.98);
                flex-direction: column;
                padding: 20px;
                gap: 20px;
                display: none;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .nav-links.active {
                display: flex;
            }

            .menu-toggle {
                display: flex;
            }

            .menu-toggle.active span:nth-child(1) {
                transform: rotate(45deg) translate(8px, 8px);
            }

            .menu-toggle.active span:nth-child(2) {
                opacity: 0;
            }

            .menu-toggle.active span:nth-child(3) {
                transform: rotate(-45deg) translate(7px, -7px);
            }

            .hero h1 {
                font-size: 36px;
            }

            .hero p {
                font-size: 18px;
            }

            .hero-buttons {
                flex-direction: column;
                align-items: center;
            }

            .hero .btn {
                width: 100%;
                max-width: 300px;
            }

            .info-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }

        /* Form Styles */
        .form-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 440px;
            margin: 0 auto;
        }

        .form-container h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .form-container .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-size: 14px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-submit {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
        }

        .form-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        .form-link {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }

        .form-link a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
        }

        .form-link a:hover {
            text-decoration: underline;
        }

        .error {
            border-color: #ef4444 !important;
        }

        .success {
            border-color: #22c55e !important;
        }

        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .hint {
            color: #888;
            font-size: 12px;
            margin-top: 5px;
        }

        .password-requirements {
            margin-top: 8px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 12px;
        }

        .requirement {
            display: flex;
            align-items: center;
            margin: 4px 0;
            color: #666;
        }

        .requirement.met {
            color: #22c55e;
        }

        .requirement::before {
            content: '○';
            margin-right: 6px;
            font-weight: bold;
        }

        .requirement.met::before {
            content: '✓';
            color: #22c55e;
        }

        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav>
    <div class="nav-container">
        <div class="logo" onclick="navigateTo('home')">MyApp</div>

        <div class="menu-toggle" id="menuToggle">
            <span></span>
            <span></span>
            <span></span>
        </div>

        <ul class="nav-links" id="navLinks">
            <li><a href="#" class="nav-link active" data-page="home">Home</a></li>
            <li id="profileNavItem" class="hidden"><a href="#" class="nav-link" data-page="profile">Profile</a></li>
            <li class="auth-buttons" id="guestButtons">
                <a href="#" class="btn btn-login nav-link" data-page="login">Login</a>
                <a href="#" class="btn btn-register nav-link" data-page="register">Sign Up</a>
            </li>
            <li class="auth-buttons hidden" id="authenticatedButtons">
                <button class="btn btn-logout" id="logoutBtn">Logout</button>
            </li>
        </ul>
    </div>
</nav>

<!-- Home Page -->
<div id="homePage" class="page-content active">
    <section class="hero">
        <h1>Welcome to MyApp</h1>
        <p>The ultimate platform to manage your tasks, connect with your team, and boost productivity like never before.</p>
        <div class="hero-buttons">
            <a href="#" class="btn btn-primary nav-link" data-page="register">Get Started</a>
            <a href="#" class="btn btn-secondary">Learn More</a>
        </div>
    </section>
</div>

<!-- Login Page -->
<div id="loginPage" class="page-content">
    <div class="form-container">
        <h2>Welcome Back</h2>
        <p class="subtitle">Login to access your account</p>

        <form id="loginForm">
            <div class="form-group">
                <label for="loginEmail">Email</label>
                <input type="text" id="loginEmail" placeholder="john@example.com" required>
                <span class="error-message" id="loginEmailError">Please enter a valid email</span>
            </div>

            <div class="form-group">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" placeholder="Enter your password" required>
                <span class="error-message" id="loginPasswordError">Please enter your password</span>
            </div>

            <button type="submit" class="form-submit">Login</button>
        </form>

        <div class="form-link">
            Don't have an account? <a class="nav-link" data-page="register">Sign up</a>
        </div>
    </div>
</div>

<!-- Register Page -->
<div id="registerPage" class="page-content">
    <div class="form-container">
        <h2>Create Account</h2>
        <p class="subtitle">Join us today and get started</p>

        <form id="registerForm">
            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" name="full_name" placeholder="John Doe" required>
                <span class="error-message" id="fullNameError">Name should only contain letters and spaces</span>
                <span class="hint">Letters and spaces only</span>
            </div>

            <div class="form-group">
                <label for="username">Username</label>
                <input type="text" id="username" name="username" placeholder="johndoe" required>
                <span class="error-message" id="usernameError">3-20 characters, letters, numbers and underscores only</span>
                <span class="hint">3-20 characters, alphanumeric and underscores</span>
            </div>

            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" name="email" placeholder="john@example.com" required>
                <span class="error-message" id="emailError">Please enter a valid email</span>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" name="password" placeholder="Min. 8 characters" required>
                <span class="error-message" id="passwordError">Password doesn't meet requirements</span>
                <div class="password-requirements">
                    <div class="requirement" id="req-length">At least 8 characters</div>
                    <div class="requirement" id="req-uppercase">One uppercase letter</div>
                    <div class="requirement" id="req-lowercase">One lowercase letter</div>
                    <div class="requirement" id="req-number">One number</div>
                    <div class="requirement" id="req-special">One special character (!@#$%^&*)</div>
                </div>
            </div>

            <div class="form-group">
                <label for="confirmedPassword">Confirm Password</label>
                <input type="password" id="confirmedPassword" name="confirmed_password" placeholder="Re-enter password" required>
                <span class="error-message" id="confirmPasswordError">Passwords do not match</span>
            </div>

            <button type="submit" class="form-submit">Create Account</button>
        </form>

        <div class="form-link">
            Already have an account? <a class="nav-link" data-page="login">Sign in</a>
        </div>
    </div>
</div>

<!-- Profile Page -->
<div id="profilePage" class="page-content">
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">
                <span class="loading-spinner"></span>
            </div>
            <h2 id="profileFullName">Loading...</h2>
            <p id="profileUsername">@username</p>
        </div>

        <div class="profile-info" id="profileInfo">
            <div class="info-row">
                <span class="info-label">Email</span>
                <span class="info-value" id="profileEmail"><span class="loading-spinner"></span></span>
            </div>
            <div class="info-row">
                <span class="info-label">Member Since</span>
                <span class="info-value" id="profileCreatedAt"><span class="loading-spinner"></span></span>
            </div>
        </div>

        <div id="profileError" class="error-message-box hidden">
            Failed to load profile information. Please try again.
        </div>
    </div>
</div>

<script>
    // ============================================
    // SESSION MANAGEMENT
    // ============================================

    const SessionManager = {
        TOKEN_KEY: 'myapp_access_token',

        setToken(token) {
            sessionStorage.setItem(this.TOKEN_KEY, token);
        },

        getToken() {
            return sessionStorage.getItem(this.TOKEN_KEY);
        },

        removeToken() {
            sessionStorage.removeItem(this.TOKEN_KEY);
        },

        isAuthenticated() {
            return !!this.getToken();
        }
    };

    // ============================================
    // API CLIENT WITH AUTOMATIC TOKEN INJECTION
    // ============================================

    const ApiClient = {
        baseURL: 'http://localhost:8080/api',

        async request(endpoint, options = {}) {
            const token = SessionManager.getToken();
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };

            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            try {
                const response = await fetch(`${this.baseURL}${endpoint}`, {
                    ...options,
                    headers
                });

                if (response.status === 401) {
                    SessionManager.removeToken();
                    updateUIForAuthState();
                    navigateTo('login');
                    throw new Error('Session expired. Please login again.');
                }

                return response;
            } catch (error) {
                console.error('API request failed:', error);
                throw error;
            }
        },

        async get(endpoint) {
            return this.request(endpoint, { method: 'GET' });
        },

        async post(endpoint, data) {
            return this.request(endpoint, {
                method: 'POST',
                body: JSON.stringify(data)
            });
        }
    };

    // ============================================
    // UI STATE MANAGEMENT
    // ============================================

    function updateUIForAuthState() {
        const isAuthenticated = SessionManager.isAuthenticated();
        const guestButtons = document.getElementById('guestButtons');
        const authenticatedButtons = document.getElementById('authenticatedButtons');
        const profileNavItem = document.getElementById('profileNavItem');

        if (isAuthenticated) {
            guestButtons.classList.add('hidden');
            authenticatedButtons.classList.remove('hidden');
            profileNavItem.classList.remove('hidden');
        } else {
            guestButtons.classList.remove('hidden');
            authenticatedButtons.classList.add('hidden');
            profileNavItem.classList.add('hidden');
        }
    }

    // ============================================
    // NAVIGATION
    // ============================================

    const menuToggle = document.getElementById('menuToggle');
    const navLinks = document.getElementById('navLinks');
    const allNavLinks = document.querySelectorAll('.nav-link');
    const pages = document.querySelectorAll('.page-content');

    menuToggle.addEventListener('click', () => {
        menuToggle.classList.toggle('active');
        navLinks.classList.toggle('active');
    });

    function navigateTo(pageName) {
        if (pageName === 'profile' && !SessionManager.isAuthenticated()) {
            navigateTo('login');
            return;
        }

        allNavLinks.forEach(l => l.classList.remove('active'));
        const targetLink = document.querySelector(`[data-page="${pageName}"]`);
        if (targetLink) {
            targetLink.classList.add('active');
        }

        pages.forEach(page => page.classList.remove('active'));
        const pageId = pageName + 'Page';
        const targetElement = document.getElementById(pageId);
        if (targetElement) {
            targetElement.classList.add('active');

            if (pageName === 'profile') {
                loadProfile();
            }
        }

        navLinks.classList.remove('active');
        menuToggle.classList.remove('active');
    }

    allNavLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetPage = link.getAttribute('data-page');
            navigateTo(targetPage);
        });
    });

    // ============================================
    // LOGOUT
    // ============================================

    document.getElementById('logoutBtn').addEventListener('click', () => {
        SessionManager.removeToken();
        updateUIForAuthState();
        navigateTo('home');
        alert('Logged out successfully!');
    });

    // ============================================
    // LOGIN
    // ============================================

    const loginForm = document.getElementById('loginForm');
    loginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = document.getElementById('loginEmail').value.trim();
        const password = document.getElementById('loginPassword').value;

        let isValid = true;

        if (password.length < 1) {
            showError('loginPassword', 'loginPasswordError');
            isValid = false;
        } else {
            hideError('loginPassword', 'loginPasswordError');
        }

        if (isValid) {
            const encodedEmail = btoa(email);
            const encodedPassword = btoa(password);

            try {
                const response = await ApiClient.post('/login', {
                    identifier: encodedEmail,
                    password: encodedPassword
                });

                const data = await response.json();

                if (response.ok && data.access_token) {
                    SessionManager.setToken(data.access_token);
                    updateUIForAuthState();
                    alert(data.message || 'Login successful!');
                    navigateTo('profile');
                    loginForm.reset();
                } else {
                    alert(data.error || 'Login failed. Please check your credentials.');
                }
            } catch (error) {
                console.error('Login error:', error);
                alert('Login failed. Please try again.');
            }
        }
    });

    // ============================================
    // REGISTER
    // ============================================

    const registerForm = document.getElementById('registerForm');
    const passwordInput = document.getElementById('password');

    function validateFullName(name) {
        const nameRegex = /^[a-zA-Z\s'-]+$/;
        return name.length >= 2 && nameRegex.test(name);
    }

    function validateUsername(username) {
        const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
        return usernameRegex.test(username);
    }

    function validatePassword(password) {
        const checks = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };
        return checks;
    }

    passwordInput.addEventListener('input', () => {
        const password = passwordInput.value;
        const checks = validatePassword(password);

        document.getElementById('req-length').classList.toggle('met', checks.length);
        document.getElementById('req-uppercase').classList.toggle('met', checks.uppercase);
        document.getElementById('req-lowercase').classList.toggle('met', checks.lowercase);
        document.getElementById('req-number').classList.toggle('met', checks.number);
        document.getElementById('req-special').classList.toggle('met', checks.special);
    });

    document.getElementById('fullName').addEventListener('input', (e) => {
        const value = e.target.value.trim();
        if (value && !validateFullName(value)) {
            showError('fullName', 'fullNameError');
        } else if (value) {
            hideError('fullName', 'fullNameError');
            e.target.classList.add('success');
        }
    });

    document.getElementById('username').addEventListener('input', (e) => {
        const value = e.target.value.trim();
        if (value && !validateUsername(value)) {
            showError('username', 'usernameError');
        } else if (value) {
            hideError('username', 'usernameError');
            e.target.classList.add('success');
        }
    });

    registerForm.addEventListener('submit', async (e) => {
        e.preventDefault();

        const fullName = document.getElementById('fullName').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmedPassword = document.getElementById('confirmedPassword').value;

        let isValid = true;

        if (!validateFullName(fullName)) {
            showError('fullName', 'fullNameError');
            isValid = false;
        } else {
            hideError('fullName', 'fullNameError');
        }

        if (!validateUsername(username)) {
            showError('username', 'usernameError');
            isValid = false;
        } else {
            hideError('username', 'usernameError');
        }

        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
            showError('email', 'emailError');
            isValid = false;
        } else {
            hideError('email', 'emailError');
        }

        const passwordChecks = validatePassword(password);
        const passwordValid = Object.values(passwordChecks).every(check => check);

        if (!passwordValid) {
            showError('password', 'passwordError');
            isValid = false;
        } else {
            hideError('password', 'passwordError');
        }

        if (password !== confirmedPassword) {
            showError('confirmedPassword', 'confirmPasswordError');
            isValid = false;
        } else {
            hideError('confirmedPassword', 'confirmPasswordError');
        }

        if (isValid) {
            const formData = {
                full_name: btoa(fullName),
                username: btoa(username),
                email: btoa(email),
                password: btoa(password),
                confirmed_password: btoa(confirmedPassword)
            };

            try {
                const response = await ApiClient.post('/register', formData);
                const data = await response.json();

                if (response.ok && data.access_token) {
                    SessionManager.setToken(data.access_token);
                    updateUIForAuthState();
                    alert(data.message || 'Registration successful!');
                    registerForm.reset();
                    document.querySelectorAll('.requirement').forEach(req => {
                        req.classList.remove('met');
                    });
                    navigateTo('profile');
                } else {
                    alert(data.error || 'Registration failed. Please try again.');
                }
            } catch (error) {
                console.error('Registration error:', error);
                alert('Registration failed. Please try again.');
            }
        }
    });

    // ============================================
    // PROFILE PAGE
    // ============================================

    async function loadProfile() {
        const profileAvatar = document.getElementById('profileAvatar');
        const profileFullName = document.getElementById('profileFullName');
        const profileUsername = document.getElementById('profileUsername');
        const profileEmail = document.getElementById('profileEmail');
        const profileUserId = document.getElementById('profileUserId');
        const profileCreatedAt = document.getElementById('profileCreatedAt');
        const profileError = document.getElementById('profileError');

        profileError.classList.add('hidden');

        try {
            const response = await ApiClient.get('/me');

            if (response.ok) {
                const result = await response.json();
                const userData = result.data || result; // Handle both wrapped and direct response

                const initials = userData.full_name
                    .split(' ')
                    .map(n => n[0])
                    .join('')
                    .toUpperCase()
                    .slice(0, 2);

                profileAvatar.textContent = initials;
                profileFullName.textContent = userData.full_name;
                profileUsername.textContent = `@${userData.username}`;
                profileEmail.textContent = userData.email;

                const createdDate = new Date(userData.created_at);
                profileCreatedAt.textContent = createdDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } else {
                throw new Error('Failed to load profile');
            }
        } catch (error) {
            console.error('Profile loading error:', error);
            profileError.classList.remove('hidden');
            profileAvatar.innerHTML = '<span style="font-size: 24px;">❌</span>';
            profileFullName.textContent = 'Error loading profile';
            profileUsername.textContent = '';
            profileEmail.textContent = 'Unable to load';
            profileUserId.textContent = 'Unable to load';
            profileCreatedAt.textContent = 'Unable to load';
        }
    }

    function showError(inputId, errorId) {
        const input = document.getElementById(inputId);
        input.classList.add('error');
        input.classList.remove('success');
        document.getElementById(errorId).style.display = 'block';
    }

    function hideError(inputId, errorId) {
        const input = document.getElementById(inputId);
        input.classList.remove('error');
        document.getElementById(errorId).style.display = 'none';
    }

    // ============================================
    // INITIALIZE APP
    // ============================================

    updateUIForAuthState();

    if (SessionManager.isAuthenticated()) {
        console.log('User is authenticated');
    }
</script>