<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, #ffeb3b 0%, #ff9800 30%, #ff5722 50%, #e91e63 70%, #9c27b0 90%, #673ab7 100%);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='4.2' numOctaves='5' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.4'/%3E%3C/svg%3E");
            opacity: 1;
            pointer-events: none;
        }

        .container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            width: 100%;
            max-width: 440px;
            position: relative;
            z-index: 1;
        }

        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: 600;
        }

        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #444;
            font-size: 14px;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s ease;
            background: white;
        }

        input:focus {
            outline: none;
            border-color: #ff9800;
            box-shadow: 0 0 0 3px rgba(255, 152, 0, 0.1);
        }

        input::placeholder {
            color: #aaa;
        }

        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ff9800 0%, #e91e63 50%, #9c27b0 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(255, 152, 0, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .login-link {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 14px;
        }

        .login-link a {
            color: #ff9800;
            text-decoration: none;
            font-weight: 600;
        }

        .login-link a:hover {
            text-decoration: underline;
        }

        .error {
            border-color: #ef4444 !important;
        }

        .success {
            border-color: #22c55e !important;
        }

        .error-message {
            color: #ef4444;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        .hint {
            color: #888;
            font-size: 12px;
            margin-top: 5px;
        }

        .password-requirements {
            margin-top: 8px;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 8px;
            font-size: 12px;
        }

        .requirement {
            display: flex;
            align-items: center;
            margin: 4px 0;
            color: #666;
        }

        .requirement.met {
            color: #22c55e;
        }

        .requirement::before {
            content: '○';
            margin-right: 6px;
            font-weight: bold;
        }

        .requirement.met::before {
            content: '✓';
            color: #22c55e;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Create Account</h1>
    <p class="subtitle">Join us today and get started</p>

    <form id="registerForm">
        <div class="form-group">
            <label for="fullName">Full Name</label>
            <input type="text" id="fullName" name="full_name" placeholder="John Doe" required>
            <span class="error-message" id="fullNameError">Name should only contain letters and spaces</span>
            <span class="hint">Letters and spaces only</span>
        </div>

        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" name="username" placeholder="johndoe" required>
            <span class="error-message" id="usernameError">3-20 characters, letters, numbers and underscores only</span>
            <span class="hint">3-20 characters, alphanumeric and underscores</span>
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" placeholder="john@example.com" required>
            <span class="error-message" id="emailError">Please enter a valid email</span>
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" name="password" placeholder="Min. 8 characters" required>
            <span class="error-message" id="passwordError">Password doesn't meet requirements</span>
            <div class="password-requirements">
                <div class="requirement" id="req-length">At least 8 characters</div>
                <div class="requirement" id="req-uppercase">One uppercase letter</div>
                <div class="requirement" id="req-lowercase">One lowercase letter</div>
                <div class="requirement" id="req-number">One number</div>
                <div class="requirement" id="req-special">One special character (!@#$%^&*)</div>
            </div>
        </div>

        <div class="form-group">
            <label for="confirmedPassword">Confirm Password</label>
            <input type="password" id="confirmedPassword" name="confirmed_password" placeholder="Re-enter password" required>
            <span class="error-message" id="confirmPasswordError">Passwords do not match</span>
        </div>

        <button type="submit">Create Account</button>
    </form>

    <div class="login-link">
        Already have an account? <a href="#">Sign in</a>
    </div>
</div>

<script>
    const form = document.getElementById('registerForm');
    const passwordInput = document.getElementById('password');

    // Simple Base64 encoding for ASCII characters
    function safeBase64Encode(str) {
        try {
            return btoa(str);
        } catch (e) {
            console.error('Base64 encoding error:', e);
            return null;
        }
    }

    // Validation functions
    function validateFullName(name) {
        // Only letters, spaces, hyphens, and apostrophes allowed
        const nameRegex = /^[a-zA-Z\s'-]+$/;
        return name.length >= 2 && nameRegex.test(name);
    }

    function validateUsername(username) {
        // 3-20 characters, alphanumeric and underscores only
        const usernameRegex = /^[a-zA-Z0-9_]{3,20}$/;
        return usernameRegex.test(username);
    }

    function validatePassword(password) {
        const checks = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
        };
        return checks;
    }

    // Real-time password validation feedback
    passwordInput.addEventListener('input', () => {
        const password = passwordInput.value;
        const checks = validatePassword(password);

        document.getElementById('req-length').classList.toggle('met', checks.length);
        document.getElementById('req-uppercase').classList.toggle('met', checks.uppercase);
        document.getElementById('req-lowercase').classList.toggle('met', checks.lowercase);
        document.getElementById('req-number').classList.toggle('met', checks.number);
        document.getElementById('req-special').classList.toggle('met', checks.special);
    });

    // Real-time validation for full name
    document.getElementById('fullName').addEventListener('input', (e) => {
        const value = e.target.value.trim();
        if (value && !validateFullName(value)) {
            showError('fullName', 'fullNameError');
        } else if (value) {
            hideError('fullName', 'fullNameError');
            e.target.classList.add('success');
        }
    });

    // Real-time validation for username
    document.getElementById('username').addEventListener('input', (e) => {
        const value = e.target.value.trim();
        if (value && !validateUsername(value)) {
            showError('username', 'usernameError');
        } else if (value) {
            hideError('username', 'usernameError');
            e.target.classList.add('success');
        }
    });

    form.addEventListener('submit', (e) => {
        e.preventDefault();

        const fullName = document.getElementById('fullName').value.trim();
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value;
        const confirmedPassword = document.getElementById('confirmedPassword').value;

        let isValid = true;

        // Validate Full Name
        if (!validateFullName(fullName)) {
            showError('fullName', 'fullNameError');
            isValid = false;
        } else {
            hideError('fullName', 'fullNameError');
        }

        // Validate Username
        if (!validateUsername(username)) {
            showError('username', 'usernameError');
            isValid = false;
        } else {
            hideError('username', 'usernameError');
        }

        // Validate Email
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email || !emailRegex.test(email)) {
            showError('email', 'emailError');
            isValid = false;
        } else {
            hideError('email', 'emailError');
        }

        // Validate Password
        const passwordChecks = validatePassword(password);
        const passwordValid = Object.values(passwordChecks).every(check => check);

        if (!passwordValid) {
            showError('password', 'passwordError');
            isValid = false;
        } else {
            hideError('password', 'passwordError');
        }

        // Validate Password Match
        if (password !== confirmedPassword) {
            showError('confirmedPassword', 'confirmPasswordError');
            isValid = false;
        } else {
            hideError('confirmedPassword', 'confirmPasswordError');
        }

        if (isValid) {
            // Base64 encode all fields with safe encoding
            const encodedFullName = safeBase64Encode(fullName);
            const encodedUsername = safeBase64Encode(username);
            const encodedEmail = safeBase64Encode(email);
            const encodedPassword = safeBase64Encode(password);
            const encodedConfirmedPassword = safeBase64Encode(confirmedPassword);

            // Check if encoding was successful
            if (!encodedFullName || !encodedUsername || !encodedEmail || !encodedPassword || !encodedConfirmedPassword) {
                alert('Encoding failed! Check console for details.');
                return;
            }

            const formData = {
                full_name: encodedFullName,
                username: encodedUsername,
                email: encodedEmail,
                password: encodedPassword,
                confirmed_password: encodedConfirmedPassword
            };

            fetch('http://localhost:8080/api/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
                .then(response => {
                    console.log('Response status:', response.status);
                    console.log('Response headers:', response.headers);
                    return response.text();
                })
                .then(text => {
                    console.log('Raw response:', text);
                    try {
                        const data = JSON.parse(text);
                        console.log('Parsed data:', data);
                        alert('Registration successful!');
                        form.reset();
                        document.querySelectorAll('.requirement').forEach(req => {
                            req.classList.remove('met');
                        });
                    } catch (e) {
                        console.error('JSON parse error:', e);
                        console.error('Response was:', text);
                        alert('Registration failed: Invalid response from server');
                    }
                })
                .catch(error => {
                    console.error('Registration error:', error);
                    alert('Registration failed. Check console for details.');
                });
        }
    });

    function showError(inputId, errorId) {
        const input = document.getElementById(inputId);
        input.classList.add('error');
        input.classList.remove('success');
        document.getElementById(errorId).style.display = 'block';
    }

    function hideError(inputId, errorId) {
        const input = document.getElementById(inputId);
        input.classList.remove('error');
        document.getElementById(errorId).style.display = 'none';
    }
</script>
</body>
</html>